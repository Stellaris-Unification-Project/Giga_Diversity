########################################
#PD overwrite colony.100
#PD !vanilla_colony_events_fix.txt
############################################
namespace = colony

### Abandoned Terraforming Equipment
planet_event = {
	id = colony.100
	title = "colony.100.name"
	desc = "colony.100.desc"
	picture = GFX_evt_underground_civilization
	show_sound = event_mystic_reveal
	location = ROOT
	trackable = yes
	
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		is_occupied_flag = no
	}
	
	trigger = {
		num_pops > 0
		habitable_planet = yes
		uses_district_set = standard
		NOR = {
			has_planet_flag = abandoned_terraforming_planet
			has_planet_flag = colony_event
			is_planet_class = pc_nuked
			is_planet_class = pc_gaia
			is_planet_class = pc_ringworld_habitable
			is_planet_class = pc_habitat
			is_planet_class = pc_city
			is_planet_class = pc_pdshroud
			is_planet_class = pc_relic
			is_planet_class = pc_milarc_relic
			is_planet_class = pc_floating
			is_planet_class = pc_crucible
			is_planet_class = pc_shroud_crucible
			is_planet_class = pc_clean_crucible
			is_planet_class = pc_crystal
			is_planet_class = pc_graveyard
			is_planet_class = pc_tidallylocked
			is_planet_class = pc_supercon
			is_planet_class = pc_ammonia
			is_planet_class = pc_sulfur
			is_planet_class = pc_acid
			is_planet_class = pc_methane
			is_planet_class = pc_ash
			is_planet_class = pc_technoorganic
			is_planet_class = pc_archive
			is_planet_class = pc_superhabitable
			is_planet_class = pc_geothermal
			is_planet_class = pc_biolumen
			is_planet_class = pc_ecocity
			is_planet_class = pc_corpoarc
			is_planet_class = pc_palacearc
			is_planet_class = pc_capitalarc
			is_planet_class = pc_necropolis
			is_planet_class = pc_machine_necropolis
			is_planet_class = pc_necrohive
			is_planet_class = pc_irradiated
			is_planet_class = pc_karst
			is_planet_class = pc_reef
			is_planet_class = pc_primal
			is_planet_class = pc_aquatic
			is_planet_class = pc_salt
			is_planet_class = pc_aquifer
			is_planet_class = pc_coral
			is_planet_class = pc_storm
			is_planet_class = pc_rogue
			is_planet_class = pc_lichen
			is_planet_class = pc_eyeball
			is_planet_class = pc_glacio
			is_planet_class = pc_lanthanide
			is_planet_class = pc_megaflora
			is_planet_class = pc_megaflorahive
			is_planet_class = pc_megafloratol
			is_planet_class = pc_bioforge
			is_planet_class = pc_biofort
			is_planet_class = pc_biocapital
			is_planet_class = pc_machine_factory
			is_planet_class = pc_machine_capital
			is_planet_class = pc_machine_fort
			is_planet_class = pc_pd_barren_cold_hab
			is_planet_class = pc_pd_barren_hab
			is_planet_class = pc_pd_frozen_hab
			is_planet_class = pc_pd_gas_giant_hab
			is_planet_class = pc_pd_hothouse_hab
			is_planet_class = pc_pd_molten_hab
			is_planet_class = pc_pd_toxic_hab
			is_planet_class = pc_pd_asteroid_hab
			is_planet_class = pc_pdshroud
			owner = { has_country_flag = abandoned_terraforming_country }
			owner = { has_authority = auth_machine_intelligence }
			#GigaStructures
			is_planet_class = pc_alderson_slice_gaia
			is_planet_class = pc_alderson_slice_ecu
			is_planet_class = pc_alderson_slice_pc
			is_planet_class = pc_ringworld_city
			is_planet_class = pc_ringworld_machine
			is_planet_class = pc_ringworld_hive
			is_planet_class = pc_squareworld_habitable
			is_planet_class = pc_birch
			is_planet_class = pc_equatorial_shipyard
			is_planet_class = pc_giga_penrose_habitable
			is_planet_class = pc_gigaorbital_ring
			is_planet_class = pc_interstellar_habitat
			is_planet_class = pc_interstellar_ringworld_habitable
			is_planet_class = pc_flat_world
			is_planet_class = pc_giga_planetary_computer
			is_planet_class = pc_habitable_gas_giant
			is_planet_class = pc_virtual_reality
			is_planet_class = pc_virtual_industry
			is_planet_class = pc_virtual_stellar_industry
			is_planet_class = pc_katzenland
			#End of added world types
			AND = {
				owner = { ideal_planet_class = pc_arid }
				is_planet_class = pc_arid
			}
			AND = {
				owner = { ideal_planet_class = pc_desert }
				is_planet_class = pc_desert
			}
			AND = {
				owner = { ideal_planet_class = pc_tropical }
				is_planet_class = pc_tropical
			}
			AND = {
				owner = { ideal_planet_class = pc_continental }
				is_planet_class = pc_continental
			}
			AND = {
				owner = { ideal_planet_class = pc_ocean }
				is_planet_class = pc_ocean
			}
			AND = {
				owner = { ideal_planet_class = pc_tundra }
				is_planet_class = pc_tundra
			}
			AND = {
				owner = { ideal_planet_class = pc_arctic }
				is_planet_class = pc_arctic
			}
			AND = {
				owner = { ideal_planet_class = pc_alpine }
				is_planet_class = pc_alpine
			}
			AND = {
				owner = { ideal_planet_class = pc_savannah }
				is_planet_class = pc_savannah
			}
			AND = {
				owner = { ideal_planet_class = pc_mangrove }
				is_planet_class = pc_mangrove
			}
			AND = {
				owner = { ideal_planet_class = pc_wetswamp }
				is_planet_class = pc_wetswamp
			}
			AND = {
				owner = { ideal_planet_class = pc_fog }
				is_planet_class = pc_fog
			}
			AND = {
				owner = { ideal_planet_class = pc_desertislands }
				is_planet_class = pc_desertislands
			}
			AND = {
				owner = { ideal_planet_class = pc_hajungle }
				is_planet_class = pc_hajungle
			} 
			AND = {
				owner = { ideal_planet_class = pc_cenote }
				is_planet_class = pc_cenote
			}
			AND = {
				owner = { ideal_planet_class = pc_cascadian }
				is_planet_class = pc_cascadian
			}
			AND = {
				owner = { ideal_planet_class = pc_swamp }
				is_planet_class = pc_swamp
			}
			AND = {
				owner = { ideal_planet_class = pc_mud }
				is_planet_class = pc_mud
			}
			AND = {
				owner = { ideal_planet_class = pc_basalt }
				is_planet_class = pc_basalt
			}
			AND = {
				owner = { ideal_planet_class = pc_subarctic }
				is_planet_class = pc_subarctic
			}
			AND = {
				owner = { ideal_planet_class = pc_glacial }
				is_planet_class = pc_glacial
			}
			AND = {
				owner = { ideal_planet_class = pc_sandsea }
				is_planet_class = pc_sandsea
			}
			AND = {
				owner = { ideal_planet_class = pc_mesa }
				is_planet_class = pc_mesa
			}
			AND = {
				owner = { ideal_planet_class = pc_badlands }
				is_planet_class = pc_badlands
			}
			AND = {
				owner = { ideal_planet_class = pc_outback }
				is_planet_class = pc_outback
			}
			AND = {
				owner = { ideal_planet_class = pc_coastal }
				is_planet_class = pc_coastal
			}
			AND = {
				owner = { ideal_planet_class = pc_oasis }
				is_planet_class = pc_oasis
			}
			AND = {
				owner = { ideal_planet_class = pc_hadesert }
				is_planet_class = pc_hadesert
			}
			AND = {
				owner = { ideal_planet_class = pc_steppe }
				is_planet_class = pc_steppe
			}
			AND = {
				owner = { ideal_planet_class = pc_frozen_desert }
				is_planet_class = pc_frozen_desert
			}
			AND = {
				owner = { ideal_planet_class = pc_boreal }
				is_planet_class = pc_boreal
			}
			AND = {
				owner = { ideal_planet_class = pc_mushroom }
				is_planet_class = pc_mushroom
			}
			AND = {
				owner = { ideal_planet_class = pc_antarctic }
				is_planet_class = pc_antarctic
			}
			AND = {
				owner = { ideal_planet_class = pc_aeolian }
				is_planet_class = pc_aeolian
			}
			AND = {
				owner = { ideal_planet_class = pc_snow }
				is_planet_class = pc_snow
			}
			AND = {
				owner = { ideal_planet_class = pc_highland }
				is_planet_class = pc_highland
			}
			AND = {
				owner = { ideal_planet_class = pc_duneforest }
				is_planet_class = pc_duneforest
			}
			AND = {
				owner = { ideal_planet_class = pc_retinal }
				is_planet_class = pc_retinal
			}
			AND = {
				owner = { ideal_planet_class = pc_forest }
				is_planet_class = pc_forest
			}
			AND = {
				owner = { ideal_planet_class = pc_lake }
				is_planet_class = pc_lake
			}
			AND = {
				owner = { ideal_planet_class = pc_tepid }
				is_planet_class = pc_tepid
			}
		}
	}
	
	is_triggered_only = yes

	immediate = {
		set_planet_flag = abandoned_terraforming_planet
		set_planet_flag = colony_event
		owner = { set_country_flag = abandoned_terraforming_country }
	}
	
	option = {
		name = colony.100.a
		hidden_effect = {
			add_modifier = {
				modifier = "abandoned_terraforming"
				days = -1
			}
		}
		begin_event_chain = {
			event_chain = "abandoned_terraforming_chain"
			target = ROOT
		}
		enable_special_project = {
			name = "ABANDONED_TERRAFORMING_1_PROJECT"
			location = this
			owner = root
		}
		enable_special_project = {
			name = "ABANDONED_TERRAFORMING_2_PROJECT"
			location = this
			owner = root
		}
	}
}

########################################
#GPM and PD both overwrite colony.104 colony.105 colony.106 colony.107 
#PD !vanilla_colony_events_fix.txt
#GPM !00_a_vanilla_colony_overwrite.txt
############################################

# Special Project Completed 1
planet_event = {
	id = colony.104
	title = "PROJECT_COMPLETE"
	desc = "colony.104.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_activating_unknown_technology
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = colony.104.a
		custom_tooltip = abandoned_terraforming_completed
		hidden_effect = {
			remove_planet_flag = pdaquapicture
			remove_modifier = "abandoned_terraforming"
				random_list = {
					3.7 = { change_pc = pc_mangrove }
					3.7 = { change_pc = pc_wetswamp }
					3.7 = { change_pc = pc_fog }
					3.7 = { change_pc = pc_desertislands }
					3.7 = { change_pc = pc_hajungle }
					3.7 = { change_pc = pc_cenote }
					3.7 = { change_pc = pc_cascadian }
					3.7 = { change_pc = pc_swamp }
					3.7 = { change_pc = pc_mud }
					3.7 = { change_pc = pc_basalt }
					3.7 = { change_pc = pc_subarctic }
					3.7 = { change_pc = pc_glacial }
					3.7 = { change_pc = pc_sandsea }
					3.7 = { change_pc = pc_mesa }
					3.7 = { change_pc = pc_badlands }
					3.7 = { change_pc = pc_outback }
					3.7 = { change_pc = pc_coastal }
					3.7 = { change_pc = pc_oasis }
					3.7 = { change_pc = pc_hadesert }
					3.7 = { change_pc = pc_steppe }
					3.7 = { change_pc = pc_frozen_desert }
					3.7 = { change_pc = pc_boreal }
					3.7 = { change_pc = pc_desert }
					3.7 = { change_pc = pc_tropical }
					3.7 = { change_pc = pc_arid }
					3.7 = { change_pc = pc_continental }
					3.7 = { change_pc = pc_ocean }
					3.7 = { change_pc = pc_tundra }
					3.7 = { change_pc = pc_arctic }
					3.7 = { change_pc = pc_alpine }
					3.7 = { change_pc = pc_savannah }	
					3.7 = { change_pc = pc_mushroom }
			}
			#integrated from GPM
			if = {									# -guilli
				limit = {
					NOT = {
						gpm_has_precursor_modifiers = yes
					}
				}
				reroll_planet_modifiers = yes		# -guilli
				gpm_remove_precursor_modifiers = yes 	# -guilli
				gpm_remove_planetary_features = yes 		# -guilli roll tombworld modifiers
				gpm_roll_planetary_features = yes 			# -guilli up to X times planetary feature 
			}
		}
	}
}

# Special Project Completed 2 (Mutated Creatures)
planet_event = {
	id = colony.105
	title = "PROJECT_COMPLETE"
	desc = "colony.105.desc"
	picture = GFX_evt_ground_combat
	show_sound = event_ground_battle
	location = ROOT
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			remove_planet_flag = pdaquapicture
			random_list = {
				3.7 = { change_pc = pc_mangrove }
				3.7 = { change_pc = pc_wetswamp }
				3.7 = { change_pc = pc_fog }
				3.7 = { change_pc = pc_desertislands }
				3.7 = { change_pc = pc_hajungle }
				3.7 = { change_pc = pc_cenote }
				3.7 = { change_pc = pc_cascadian }
				3.7 = { change_pc = pc_swamp }
				3.7 = { change_pc = pc_mud }
				3.7 = { change_pc = pc_basalt }
				3.7 = { change_pc = pc_subarctic }
				3.7 = { change_pc = pc_glacial }
				3.7 = { change_pc = pc_sandsea }
				3.7 = { change_pc = pc_mesa }
				3.7 = { change_pc = pc_badlands }
				3.7 = { change_pc = pc_outback }
				3.7 = { change_pc = pc_coastal }
				3.7 = { change_pc = pc_oasis }
				3.7 = { change_pc = pc_hadesert }
				3.7 = { change_pc = pc_steppe }
				3.7 = { change_pc = pc_frozen_desert }
				3.7 = { change_pc = pc_boreal }
				3.7 = { change_pc = pc_desert }
				3.7 = { change_pc = pc_tropical }
				3.7 = { change_pc = pc_arid }
				3.7 = { change_pc = pc_continental }
				3.7 = { change_pc = pc_ocean }
				3.7 = { change_pc = pc_tundra }
				3.7 = { change_pc = pc_arctic }
				3.7 = { change_pc = pc_alpine }
				3.7 = { change_pc = pc_savannah }	
				3.7 = { change_pc = pc_mushroom }
						
			}
			remove_modifier = "abandoned_terraforming"
			owner = { set_country_flag = terraforming_mutants_invade_country }
			set_planet_flag = terraforming_mutants_invade_planet
			create_country = {
				name = "NAME_Deformed_Creatures"
				type = faction
				effect = {
					establish_communications_no_message = root.owner
				}
			}
			create_army = {
				name = "NAME_Deformed_Creatures"
				owner = last_created_country
				type = "mutant_army"
			}
			create_army = {
				name = "NAME_Twisted_Beasts"
				owner = last_created_country
				type = "mutant_army"
			}
			create_army = {
				name = "NAME_Mutated_Horrors"
				owner = last_created_country
				type = "mutant_army"
			}
			if = {									# -guilli
				limit = {
					NOT = {
						gpm_has_precursor_modifiers = yes
					}
				}
				reroll_planet_modifiers = yes		# -guilli
				gpm_remove_precursor_modifiers = yes 	# -guilli
				gpm_remove_planetary_features = yes 		# -guilli roll tombworld modifiers
				gpm_roll_planetary_features = yes 			# -guilli up to X times planetary feature 
			}
		}
	}
	
	option = {
		name = colony.105.a
		custom_tooltip = terraforming_mutants_attack
	}
}

# Special Project Completed 3 (Gaia World)
planet_event = {
	id = colony.106
	title = "PROJECT_COMPLETE"
	desc = "colony.106.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_activating_unknown_technology
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = MARVELOUS
		change_pc = pc_gaia
		add_modifier = {
			modifier = "gaia_world"
			days = -1
		}
		add_deposit = d_pdgaia
		hidden_effect = {
			remove_modifier = "abandoned_terraforming"
			remove_planet_flag = pdaquapicture
			if = {									# -guilli
				limit = {
					NOT = {
						gpm_has_precursor_modifiers = yes
					}
				}
				reroll_planet_modifiers = yes		# -guilli
				gpm_remove_precursor_modifiers = yes 	# -guilli
				gpm_remove_planetary_features = yes 		# -guilli roll tombworld modifiers
				gpm_roll_planetary_features = yes 			# -guilli up to X times planetary feature 
			}
		}
	}
}

# Special Project Completed 4 (Tomb World)
planet_event = {
	id = colony.107
	title = "PROJECT_COMPLETE"
	desc = {
		trigger = {
			NOR = {
				owner = { has_origin = origin_post_apocalyptic }
				owner.species = { has_trait = trait_pc_nuked_preference }
				owner.species = { has_trait = trait_pc_irradiated_preference }
			}
		}
		text = "colony.107.desc"
	}
	desc = {
		trigger = {
			OR = {
				owner = { has_origin = origin_post_apocalyptic }
				owner.species = { has_trait = trait_pc_nuked_preference }
				owner.species = { has_trait = trait_pc_irradiated_preference }
			}
		}
		text = "colony.107.desc.nuked_pref"
	}
	picture = GFX_evt_dead_city
	show_sound = event_activating_unknown_technology
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOR = {
				owner = { has_origin = origin_post_apocalyptic }
				owner.species = { has_trait = trait_pc_nuked_preference }
				owner.species = { has_trait = trait_pc_irradiated_preference }
			}
		}
		name = colony.107.a
		change_pc = pc_nuked
		hidden_effect = { set_planet_flag = nuked_planet_anomalies_disabled }
		if = { #Destroys colony if no planet pops can live on Tomb Worlds
			limit = {
				NOT = {
					any_owned_pop = {
						OR = {
							has_trait = trait_pc_nuked_preference
							has_trait = trait_pc_irradiated_preference
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
						}
					}
				}
			}
			destroy_colony = yes
		}
		else = { #Kills only planet pops that cannot live on Tomb Worlds
			hidden_effect = {
				every_owned_pop = {
					limit = {
						NOR = {
							has_trait = trait_pc_nuked_preference
							has_trait = trait_pc_irradiated_preference
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
						}
					}
					kill_pop = yes
				}
			}
			custom_tooltip = colony.107.a.tooltip
		}
		hidden_effect = {
			remove_modifier = "abandoned_terraforming"
			remove_planet_flag = pdaquapicture
			if = {									# -guilli
				limit = {
					NOT = {
						gpm_has_precursor_modifiers = yes
					}
				}
				reroll_planet_modifiers = yes		# -guilli
				gpm_remove_precursor_modifiers = yes 	# -guilli
			}
			if = {
				limit = { has_planet_flag = gpm_is_wondrous_planet }
				remove_planet_flag = gpm_is_wondrous_planet
				remove_planet_flag = gpm_is_wondrous_planet_colour
				remove_modifier = gpm_planet_wonder_discovered
				set_name = color_default_white
			}
			if = {
				limit = { has_planet_flag = gpm_is_precursor_world }
				add_modifier = { modifier = terraforming_candidate days = -1 } 
				set_name = color_precursor_col
			}
		}
	}
	option = {
		trigger = {
			OR = {
				owner = { has_origin = origin_post_apocalyptic }
				owner.species = { has_trait = trait_pc_nuked_preference }
				owner.species = { has_trait = trait_pc_irradiated_preference }
			}
		}
		name = EXCELLENT
		hidden_effect = { change_pc = pc_nuked }
		set_planet_flag = nuked_planet_anomalies_disabled		
		hidden_effect = {
			remove_modifier = "abandoned_terraforming"
			remove_planet_flag = pdaquapicture
			#
			if = {									# -guilli
				limit = {
					NOT = {
						gpm_has_precursor_modifiers = yes
					}
				}
				reroll_planet_modifiers = yes		# -guilli
				gpm_remove_precursor_modifiers = yes 	# -guilli
			}
			if = {
				limit = { has_planet_flag = gpm_is_wondrous_planet }
				remove_planet_flag = gpm_is_wondrous_planet
				remove_planet_flag = gpm_is_wondrous_planet_colour
				remove_modifier = gpm_planet_wonder_discovered
				set_name = color_default_white
			}
			if = {
				limit = { has_planet_flag = gpm_is_precursor_world }
				add_modifier = { modifier = terraforming_candidate days = -1 } 
				set_name = color_precursor_col
			}
		}
	}
}